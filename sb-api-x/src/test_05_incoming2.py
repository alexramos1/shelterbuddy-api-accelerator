from chalicelib import localrules
from chalicelib import sb_incoming
import json

jsonStr = r'''
{"Name": "Freedom", "DateOfBirthUtc": "2016-01-02T08:00:00Z", "License": {"Tag": null, "Issuer": null}, "EuthanasiaReason": null, "AdoptionFee": 65.0, "AdoptionSummary": "<p><strong><span style=\"color: #0ba7b4;\">How Freedom arrived:</span><br /></strong> Freedom was brought in by his previous owner on May 21, 2020.</p> <p><strong><span style=\"color: #0ba7b4;\">At SDHS:</span><br /></strong>Freedom has been receiving excellent care and is now ready for his new home!</p> <p><strong><span style=\"color: #0ba7b4;\">Why this pet is the one for you:</span><br /></strong>This sweet boy is Freedom and yes, his highlights are natural. He was voted best looking in his litter and it shows!  While in our care, Freedom has been sweet, gentle, and friendly. He has lived with other animals his entire life and has decided that it is not his vibe anymore. He is looking for a quiet home where he can relax and maybe finally take up meditation. He got a yoga mat for his birthday that would look great in your living room! Freedom does best with older and respectful children. It's all about the stress relief for this guy and our adoption counselors are happy to go over behavior in the home and medical history. Contact us if this beautiful babe might be a good fit for your home!<strong><br /></strong></p>\n<script src=\"https://www.adoptmeapp.org/js/widget.js\"></script>\n<div style=\"max-width: 440px; border-style: solid; border-width: 0px\" \nwidget-width=\"auto\" \nwidget-height=\"600\" \nclass=\"adoptme_widget\" \nwidget-shelter=\"\" \nwidget-animal_id=\"201772\"></div>\n\n", "Age": {"IsApproximate": false, "Months": 4, "Weeks": 3, "Years": 4, "AgeGroup": {"Name": "Adolescent (6-12mos)", "Id": 2}}, "Breed": {"Primary": {"Name": "Domestic Longhair", "Uri": "/api/v2/animal/species/breed/4225", "Id": 4225}, "PrimarySpecies": {"Uri": "/api/v2/animal/species/19", "Id": 19}, "Secondary": null, "SecondarySpecies": null, "IsCrossBreed": true}, "BreederRegistrationNumber": null, "ContactLocation": {"Name": "San Diego Campus - 5480", "Uri": "/api/v2/location/physicallocation/89", "Id": 89}, "Features": {"CoatLength": null, "PrimaryColour": "Red Tabby", "SecondaryColour": null, "CoatType": null, "EarType": null, "TailType": null, "EyeColour": null}, "Identification": {"HasMicrochip": true, "PrimaryMicrochipNumber": "985112006986099", "PrimaryMicrochipBrand": {"Name": "Home Again", "Id": 14}, "PrimaryMicrochipImplantDateUtc": null, "SecondaryMicrochipNumber": null, "SecondaryMicrochipBrand": null, "SecondaryMicrochipImplantDateUtc": null, "OtherIdentification": null, "AcoNumber": null, "TagColour": null, "CollarType": null, "Barcode": null, "ShelterTag": null, "CustomTag": "FIC", "CollarColour": null, "OldDatabaseNumber": null}, "Intake": {"DateUtc": "2020-05-21T20:53:00Z", "Region": {"Name": "San Diego Campus - 5500", "Uri": "/api/v2/location/physicallocation/53", "Id": 53}, "Source": {"Name": "Owner Surrender", "Uri": "/api/v2/animal/source/2", "Id": 2}, "ExtendedDetails": {"Uri": "/api/v2/animal/sourcehistory/970284", "Id": 970284}, "Received": {"Name": "Behavior", "Id": 1728}, "SurrenderReason": {"Name": "Not housebroken/Not using litter box", "Uri": "/api/v2/animal/surrenderreason/233", "Id": 233}, "BehaviourCondition": null, "EmergencyBoardingReason": null}, "LastUpdatedUtc": "2020-05-26T22:24:41.36Z", "Location": {"PhysicalLocation": {"Name": "San Diego Campus - 5480", "Uri": "/api/v2/location/physicallocation/89", "Id": 89}, "Kennel": {"Name": "9", "Uri": "/api/v2/shelter/kennel/48845", "Id": 48845}, "Shelter": {"Name": "Cat C", "Uri": "/api/v2/shelter/646", "Id": 646}, "MostRecentPhysicalLocation": {"Name": "San Diego Campus - 5480", "Uri": "/api/v2/location/physicallocation/89", "Id": 89}}, "Medical": {"IsDeclawed": false, "IsVaccinated": true, "SpayedNeutered": "Yes", "PreferredFood": null, "PreviousMedicalDetails": null}, "Owner": {"Name": "Nicole Diaz", "Uri": "/api/v2/person/217450", "Id": 217450}, "Pattern": null, "Sex": {"Name": "Male", "Uri": "/api/v2/animal/gender/1", "Id": 1}, "Size": null, "Status": {"DateUtc": "2020-05-26T20:50:00Z", "Name": "Available for Adoption - Waiting Space", "Uri": "/api/v2/animal/status/129", "Id": 129}, "SubStatus": null, "SubStatuses": [], "Type": {"Name": "Cat", "Uri": "/api/v2/animal/species/type/2", "Id": 2}, "AvailableForAdoptionDateUtc": "1900-01-01T00:00:00Z", "DateOfWeighingUtc": "2020-05-21T07:00:00Z", "CurrentRabiesVaccination": null, "Litters": [{"Uri": "/api/v2/animal/litter/5404", "Id": 5404}], "RabiesTag": null, "Origin": null, "DangerousAnimalInformation": null, "LostFoundAddress": {"Country": {"Name": "United States", "Uri": "/api/v2/location/country/1", "Id": 1}, "Jurisdiction": {"Name": "El Cajon", "Uri": "/api/v2/jurisdiction/1940", "Id": 1940}, "State": {"Abbreviation": "CA", "Name": "California", "Uri": "/api/v2/location/state/55", "Id": 55}, "StreetType": null, "Suburb": {"Name": "El Cajon", "Uri": "/api/v2/location/suburb/120039", "Id": 120039}, "DeliveryType": null, "PrintableString": "El Cajon, CA, 92021, United States", "PrintableStreetAddressString": "El Cajon, CA, 92021, United States", "CrossStreet": "", "DirectionOne": "", "DirectionTwo": "", "ExtraAddressDetails": "", "Postcode": "92021", "PostcodeSuffix": null, "StreetName": "", "StreetNumber": "", "UnitNumber": "", "DeliveryNumber": "", "IsApiValidated": false, "Id": 1587279}, "DateFoundUtc": null, "DateLostUtc": null, "IsDeleted": false, "Icons": [{"Name": "No Cats", "Id": 1}, {"Name": "No Dogs", "Id": 2}], "Weight": "13.4 lbs", "MetaData": [], "RelatedAnimals": null, "Behaviour": null, "Media": null, "DistinguishingFeatures": "Photo Available", "DueDateOutUtc": "2020-05-29T07:00:00Z", "Id": 201772, "StatusCategory": "available"}
'''

animal = json.loads(jsonStr)

print('Id=', animal['Id'])
#animal['Id'] = 1
animal['LastUpdatedUtc'] = '2020-01-01T00:00:00Z'

triage = localrules.triageForWeb(animal)  # normally done in sb_sync.action() before handoff to incoming()
print("triage result = %s" % triage)
sb_incoming.process(animal)
